[gd_scene load_steps=19 format=3 uid="uid://caii6kubshjjo"]

[ext_resource type="Script" path="res://Player/player.gd" id="1_2kueo"]
[ext_resource type="Script" path="res://Player/fake_shadow_controller.gd" id="2_x5y8f"]
[ext_resource type="Texture2D" uid="uid://dgv0pbix61uoi" path="res://Assets/FakeShadow.png" id="3_ydy22"]
[ext_resource type="Script" path="res://StateMachine/state_machine.gd" id="5_m5q7j"]
[ext_resource type="Script" path="res://StateMachine/States/idle.gd" id="6_lqdse"]
[ext_resource type="Script" path="res://StateMachine/States/move.gd" id="7_8wl0i"]
[ext_resource type="Script" path="res://StateMachine/States/dash.gd" id="7_tk8tp"]
[ext_resource type="Script" path="res://StateMachine/States/jump.gd" id="8_4u8g6"]
[ext_resource type="Script" path="res://Player/power_up_controller.gd" id="8_dalj3"]
[ext_resource type="Script" path="res://StateMachine/States/fall.gd" id="9_1fa66"]
[ext_resource type="Script" path="res://Player/PowerUps/PowerUpBase.gd" id="9_xy2m8"]
[ext_resource type="Script" path="res://Player/camera_target_controller.gd" id="10_2vevn"]
[ext_resource type="Resource" uid="uid://drbdse8jvrws3" path="res://Player/PowerUps/Dash.tres" id="10_ocg16"]

[sub_resource type="CapsuleShape3D" id="CapsuleShape3D_pipuh"]
radius = 0.3
height = 1.7

[sub_resource type="PlaneMesh" id="PlaneMesh_o3771"]

[sub_resource type="StandardMaterial3D" id="StandardMaterial3D_exhji"]
transparency = 1
albedo_texture = ExtResource("3_ydy22")

[sub_resource type="CapsuleMesh" id="CapsuleMesh_g33ns"]
radius = 0.3
height = 1.7

[sub_resource type="BoxMesh" id="BoxMesh_obb3j"]
size = Vector3(0.2, 0.2, 0.2)

[node name="Player" type="CharacterBody3D" node_paths=PackedStringArray("camera", "fake_shadow_controller", "state_machine", "power_up_controller")]
collision_layer = 2
script = ExtResource("1_2kueo")
camera = NodePath(".")
fake_shadow_controller = NodePath("FakeShadowController")
state_machine = NodePath("StateMachine")
power_up_controller = NodePath("PowerUpController")
JUMP_PEAK_TIME = 0.25
JUMP_FALL_TIME = 0.25

[node name="StateMachine" type="Node" parent="." node_paths=PackedStringArray("body", "default_state")]
script = ExtResource("5_m5q7j")
body = NodePath("..")
default_state = NodePath("Idle")

[node name="Idle" type="Node" parent="StateMachine" node_paths=PackedStringArray("move_state", "jump_state", "fall_state", "dash_state")]
script = ExtResource("6_lqdse")
move_state = NodePath("../Move")
jump_state = NodePath("../Jump")
fall_state = NodePath("../Fall")
dash_state = NodePath("../Dash")

[node name="Move" type="Node" parent="StateMachine" node_paths=PackedStringArray("idle_state", "jump_state", "fall_state", "dash_state")]
script = ExtResource("7_8wl0i")
idle_state = NodePath("../Idle")
jump_state = NodePath("../Jump")
fall_state = NodePath("../Fall")
dash_state = NodePath("../Dash")

[node name="Jump" type="Node" parent="StateMachine" node_paths=PackedStringArray("fall_state", "idle_state", "move_state", "dash_state")]
script = ExtResource("8_4u8g6")
fall_state = NodePath("../Fall")
idle_state = NodePath("../Idle")
move_state = NodePath("../Move")
dash_state = NodePath("../Dash")

[node name="Fall" type="Node" parent="StateMachine" node_paths=PackedStringArray("move_state", "idle_state", "dash_state")]
script = ExtResource("9_1fa66")
move_state = NodePath("../Move")
idle_state = NodePath("../Idle")
dash_state = NodePath("../Dash")

[node name="Dash" type="Node" parent="StateMachine" node_paths=PackedStringArray("move_state", "idle_state", "fall_state")]
script = ExtResource("7_tk8tp")
move_state = NodePath("../Move")
idle_state = NodePath("../Idle")
fall_state = NodePath("../Fall")

[node name="PowerUpController" type="Node" parent="."]
script = ExtResource("8_dalj3")
powerup_collection = Array[ExtResource("9_xy2m8")]([ExtResource("10_ocg16")])

[node name="CollisionShape3D" type="CollisionShape3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.85, 0)
shape = SubResource("CapsuleShape3D_pipuh")

[node name="CameraTargetController" type="Node3D" parent="." node_paths=PackedStringArray("camera_raycast", "camera_target")]
script = ExtResource("10_2vevn")
camera_raycast = NodePath("CameraTargetRaycast")
camera_target = NodePath("CameraTarget")

[node name="CameraTarget" type="Node3D" parent="CameraTargetController"]

[node name="CameraTargetRaycast" type="RayCast3D" parent="CameraTargetController"]
target_position = Vector3(0, -10, 0)

[node name="FakeShadowController" type="Node3D" parent="." node_paths=PackedStringArray("shadow_raycast", "shadow_anchor")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 0)
script = ExtResource("2_x5y8f")
shadow_raycast = NodePath("ShadowRaycast")
shadow_anchor = NodePath("FakeShadow")

[node name="ShadowRaycast" type="RayCast3D" parent="FakeShadowController"]
target_position = Vector3(0, -20, 0)
collision_mask = 5
debug_shape_custom_color = Color(0, 1, 0.8, 1)
debug_shape_thickness = 4

[node name="FakeShadow" type="MeshInstance3D" parent="FakeShadowController"]
transform = Transform3D(0.5, 0, 0, 0, 0.5, 0, 0, 0, 0.5, 0, 0, 0)
mesh = SubResource("PlaneMesh_o3771")
skeleton = NodePath("../..")
surface_material_override/0 = SubResource("StandardMaterial3D_exhji")

[node name="Graphics" type="MeshInstance3D" parent="."]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.85, 0)
mesh = SubResource("CapsuleMesh_g33ns")

[node name="Eyes" type="MeshInstance3D" parent="Graphics"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.547417, -0.303576)
mesh = SubResource("BoxMesh_obb3j")

[connection signal="landed" from="StateMachine/Idle" to="." method="landed"]
[connection signal="landed" from="StateMachine/Move" to="." method="landed"]
[connection signal="just_dashed" from="StateMachine/Dash" to="." method="just_dashed"]
